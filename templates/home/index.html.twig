{% extends 'base.html.twig' %}

{% block body %}
  <section class="hero">
    <div class="card">
      <h1 class="h1">Prévisions météo locales</h1>
      <p class="muted">Entrez une ville pour obtenir un aperçu clair et rapide.</p>

      <form id="city-form" class="grid" method="get" action="{{ path('home') }}" autocomplete="off" role="search" aria-label="Recherche de ville">
        <div class="input-wrap">
          <svg aria-hidden="true" class="icon"><use href="#icon-search"/></svg>
          <input
            class="input"
            name="city"
            placeholder="Rechercher une ville (ex. Paris, Lyon, Toulouse)"
            value="{{ city|default('') }}"
          />
        </div>

        {# Hidden fields used by the geolocation flow #}
        <input type="hidden" name="lat" id="geo-lat">
        <input type="hidden" name="lon" id="geo-lon">

        <div class="actions">
          <button class="btn" type="submit">Rechercher</button>
          <button class="btn btn-secondary" type="button" title="Utiliser ma position" aria-label="Utiliser ma position">
            <svg class="icon" aria-hidden="true"><use href="#icon-pin"/></svg>
            <span class="btn-text">Autour de moi</span>
          </button>
        </div>
      </form>

      <div id="geo-message" class="geo-message muted small"></div>

      {# Location banner #}
      {% if place %}
        <p class="muted small">
          Lieu : {{ place.name }}{% if place.admin1 %} ({{ place.admin1 }}){% endif %}{% if place.country %}, {{ place.country }}{% endif %}
        </p>
      {% elseif coords %}
        <p class="muted small">
          Coordonnées : {{ coords.latitude|number_format(4, '.', '') }}, {{ coords.longitude|number_format(4, '.', '') }}
        </p>
      {% endif %}

      {# Display backend error if any #}
      {% if error is defined and error %}
        <div class="geo-message error small">{{ error }}</div>
      {% endif %}

      <p class="muted small">Astuce : appuyez sur Entrée pour lancer la recherche.</p>
    </div>

    <div class="hero-visual card" aria-hidden="true">
      <div class="visual-placeholder"></div>
      <p class="muted small">Aperçu graphique — sera remplacé par un visuel météo.</p>
    </div>
  </section>

  <section class="grid grid-3 section-gap">
    {% include 'components/_weather_card.html.twig' with {
      icon: 'icon-thermo',
      title: 'Température',
      content: cards.temperature|raw
    } %}

    {% include 'components/_weather_card.html.twig' with {
      icon: 'icon-wind',
      title: 'Vent',
      content: cards.wind|raw
    } %}

    {% include 'components/_weather_card.html.twig' with {
      icon: 'icon-drop',
      title: 'Précipitations',
      content: cards.precipitation|raw
    } %}
  </section>

  {% include 'components/_forecast_hourly.html.twig' with {
    hours: hours
  } %}

  {# Daily forecast partial #}
  {% include 'components/_forecast_daily.html.twig' with {
    days: days
    } %}
{% endblock %}
