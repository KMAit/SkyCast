{% extends 'base.html.twig' %}

{% block body %}

  {# Hero section with search form #}
  <section class="hero">
    <div class="card">
      <h1 class="h1">Prévisions météo locales</h1>
      <p class="muted">Entrez une ville pour obtenir un aperçu clair et rapide.</p>

      <form id="city-form" class="grid" method="get" action="{{ path('home') }}" autocomplete="off" role="search" aria-label="Recherche de ville">
        <div class="input-wrap">
          <svg aria-hidden="true" class="icon"><use href="#icon-search"/></svg>
          <input
            class="input"
            name="city"
            placeholder="Rechercher une ville (ex. Paris, Lyon, Toulouse)"
            value="{{ city|default('') }}"
          />
        </div>

        {# Hidden fields used by the geolocation flow #}
        <input type="hidden" name="lat" id="geo-lat">
        <input type="hidden" name="lon" id="geo-lon">

        <div class="actions">
          <button class="btn" type="submit">Rechercher</button>
          <button class="btn btn-secondary" type="button" title="Utiliser ma position" aria-label="Utiliser ma position">
            <svg class="icon" aria-hidden="true"><use href="#icon-pin"/></svg>
            <span class="btn-text">Autour de moi</span>
          </button>
        </div>
      </form>

      <div id="geo-message" class="geo-message muted small"></div>

      {# Location banner #}
      {% if place %}
        <p class="muted small">
          Lieu : {{ place.name }}{% if place.admin1 %} ({{ place.admin1 }}){% endif %}{% if place.country %}, {{ place.country }}{% endif %}
        </p>
      {% elseif coords %}
        <p class="muted small">
          Coordonnées : {{ coords.latitude|number_format(4, '.', '') }}, {{ coords.longitude|number_format(4, '.', '') }}
        </p>
      {% endif %}

      {# Display backend error if any #}
      {% if error is defined and error %}
        <div class="geo-message error small">{{ error }}</div>
      {% endif %}

      <p class="muted small">Astuce : appuyez sur Entrée pour lancer la recherche.</p>
    </div>

        {% include 'components/_hourly_chart.html.twig' with {hours: hours} %}
  </section>

  {# Current conditions — qualitative context (icon + label + timestamp) #}
  {% if current is defined and current %}
    <section class="card section-gap">
      <h2 class="h2">
        <svg class="icon" aria-hidden="true"><use href="#icon-{{ current.icon|default('na') }}"/></svg>
        <span>Conditions actuelles — {{ current.label|default('—') }}</span>
      </h2>
      <p class="muted small">
        Mise à jour :
        {{ current.time|format_datetime(locale='fr', timezone='Europe/Paris', pattern="'le' dd/MM 'à' HH:mm") }}
      </p>
    </section>
  {% endif %}


  {# Current data — quantitative KPIs (complement to current conditions) #}
  <section class="card section-gap">
    <h2 class="h2">
      <svg class="icon" aria-hidden="true"><use href="#icon-thermo"/></svg>
      <span>Données actuelles</span>
    </h2>

    <div class="grid grid-3" style="margin-top:10px">
      {% include 'components/_weather_card.html.twig' with {icon: 'icon-thermo', title: 'Température', content: cards.temperature|raw} %}
      {% include 'components/_weather_card.html.twig' with {icon: 'icon-wind', title: 'Vent', content: cards.wind|raw} %}
      {% include 'components/_weather_card.html.twig' with {icon: 'icon-drop', title: 'Précipitations', content: cards.precipitation|raw} %}
    </div>
  </section>

  {# Hourly forecast — whole-day carousel #}
  {% include 'components/_forecast_hourly_carousel.html.twig' with {hours_today: hours_today} %}

  {# Daily forecast (7 days) #}
  {% include 'components/_forecast_daily.html.twig' with {days: days} %}

{% endblock %}
